# Manually trigger tests
name: Validate Markdown Contents

on:
  # Manual trigger from the UI
  workflow_dispatch:

env:
  FORCE_COLOR: true

# Automatically cancel in-progress actions on the same branch
concurrency:
  group: ${{ github.workflow }}-${{ github.event_name == 'pull_request_target' && github.head_ref || github.ref }}
  cancel-in-progress: true

jobs:
  # Verify files are ok.
  test:
    runs-on: ubuntu-latest
    timeout-minutes: 6
    steps:
    - uses: actions/checkout@v2.3.2
    # Install dependencies
    - uses: bahmutov/npm-install@v1
    # Run tests
    - run: npm t
    # Add comment
    - name: Add PR error comment
      if: failure()
      uses: actions/github-script@v3
      with:
        github-token: ${{secrets.GITHUB_TOKEN}}
        script: |
          const fs = require('fs')
          const path = require('path')
          const errors = fs.readFileSync(path.resolve(__dirname, 'errors.json'))
          console.log('errors', errors)
          // Write to PR
          github.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: ' Ups, something went wrong. Please checkout the following error:  '
          });